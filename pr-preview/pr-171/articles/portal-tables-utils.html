<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nfportalutils">
<title>Portal tables utils • nfportalutils</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Portal tables utils">
<meta property="og:description" content="nfportalutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nfportalutils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9500</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/access-utilities.html">Access utilities</a>
    <a class="dropdown-item" href="../articles/annotate-nf-processed-data.html">Annotating nextflow processed data</a>
    <a class="dropdown-item" href="../articles/bringing-portal-data-to-other-platforms-cbioportal.html">Bringing Portal Data to Other Platforms: cBioPortal</a>
    <a class="dropdown-item" href="../articles/portal-tables-utils.html">Portal tables utils</a>
    <a class="dropdown-item" href="../articles/revalidation-workflows.html">Revalidation workflows</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nf-osi/nfportalutils/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Portal tables utils</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nf-osi/nfportalutils/blob/HEAD/vignettes/portal-tables-utils.Rmd" class="external-link"><code>vignettes/portal-tables-utils.Rmd</code></a></small>
      <div class="d-none name"><code>portal-tables-utils.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nf-osi/nfportalutils" class="external-link">nfportalutils</a></span><span class="op">)</span></span>
<span><span class="fu">synapser</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/synapser/man/synLogin.html" class="external-link">synLogin</a></span><span class="op">(</span>authToken <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"SYNAPSE_AUTH_TOKEN"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="nf-portal-tables-overview">NF Portal Tables Overview<a class="anchor" aria-label="anchor" href="#nf-portal-tables-overview"></a>
</h2>
<p>These tables behind the NF Data Portal have grown over time and need
maintenance like any other infrastructure. This walks through the
original use cases for these utils to accomplish tasks such as:</p>
<ul>
<li>Add new publications to Portal - Publications</li>
<li>Cleaning or migrating data, e.g. correcting an annotation “rnaSeq”
to “RNA-seq” within Portal - Files</li>
<li>Add new people to Portal - People</li>
<li>Register a new study to Portal - Studies **</li>
<li>For each study in Portal - Studies, fill in related studies **</li>
</ul>
<p>Some tasks marked ** are no longer done manually much of the time
(having been automated as part of larger workflows), so they’ll be
covered more briefly. When requirements change, having a sense of what
these utils do can help understand where, what, and how to update.</p>
<div class="section level3">
<h3 id="how-this-will-work">How this will work<a class="anchor" aria-label="anchor" href="#how-this-will-work"></a>
</h3>
<p>We’ll make copies of the relevant portal tables for update-type
operations. What this also provides is an example workflow to follow for
contributors who need to develop these utils and do testing.</p>
<p><strong>First set your private development project id, which will be
the parent project to host the table copies.</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">project_id</span> <span class="op">&lt;-</span> <span class="st">"syn26462036"</span> <span class="co"># the NF-dev-playground project</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="portal---publications-updates">Portal - Publications updates<a class="anchor" aria-label="anchor" href="#portal---publications-updates"></a>
</h3>
<p>There are actually two options for adding publications:
<code>add_publication_from_pubmed</code> and
<code>add_publication_from_unpaywall</code>. The <code>pubmed</code>
option is the default, and <code>unpaywall</code> is an additional
option if there is no <code>pmid</code>.</p>
<p>Start with creating a table copy to work with.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PUBS_COPY</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_table.html">copy_table</a></span><span class="op">(</span><span class="st">"syn16857542"</span>, destination_id <span class="op">=</span> <span class="va">project_id</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="adding-1-2-publications-at-a-time">Adding 1-2 publications at a time<a class="anchor" aria-label="anchor" href="#adding-1-2-publications-at-a-time"></a>
</h4>
<p>The minimum information needed is <code>pmid</code> (the new pub to
add) and <code>study_id</code> (the linked study). This can use
<code>add_publication_from_pubmed</code>, which pulls in author,
journal, etc. from PubMed. What might need further explanation is the
involvement of <code>study_table_id</code> – this needs to be a table
where <code>studyId</code>, <code>studyName</code>,
<code>fundingAgency</code> can be looked up to help fill
<code>fundingAgency</code> with consistency.</p>
<p>Since this is a demo, the papers are not actually related or
accurately classified at all. Commands show adding papers with and
without additional <code>disease_focus</code> and
<code>manifestation</code> labels (which were once manually
derived).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">STUDY_TABLE</span> <span class="op">&lt;-</span> <span class="st">"syn52694652"</span> <span class="co"># we will READ ONLY from this table</span></span>
<span><span class="fu">nfportalutils</span><span class="fu">::</span><span class="fu"><a href="../reference/add_publication_from_pubmed.html">add_publication_from_pubmed</a></span><span class="op">(</span>pmid <span class="op">=</span> <span class="fl">38383787</span>,</span>
<span>                            study_id <span class="op">=</span> <span class="st">"syn11672851"</span>,</span>
<span>                            disease_focus <span class="op">=</span> <span class="st">"Neurofibromatosis type 1"</span>,</span>
<span>                            manifestation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MPNST"</span><span class="op">)</span>,</span>
<span>                            publication_table_id <span class="op">=</span> <span class="va">PUBS_COPY</span>,</span>
<span>                            study_table_id <span class="op">=</span> <span class="va">STUDY_TABLE</span>,</span>
<span>                            dry_run <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">nfportalutils</span><span class="fu">::</span><span class="fu"><a href="../reference/add_publication_from_pubmed.html">add_publication_from_pubmed</a></span><span class="op">(</span>pmid <span class="op">=</span> <span class="fl">38383777</span>,</span>
<span>                            study_id <span class="op">=</span> <span class="st">"syn11672851"</span>,</span>
<span>                            publication_table_id <span class="op">=</span> <span class="va">PUBS_COPY</span>,</span>
<span>                            study_table_id <span class="op">=</span> <span class="va">STUDY_TABLE</span>,</span>
<span>                            dry_run <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adding-publications-in-large-batch-from-a-spreadsheet">Adding publications in large batch, from a spreadsheet<a class="anchor" aria-label="anchor" href="#adding-publications-in-large-batch-from-a-spreadsheet"></a>
</h4>
<p>Large batches are often put in a spreadsheet and should instead use
<code>add_publications_from_file</code>. The spreadsheet needs to have
[<code>studyId</code>, <code>pmid</code>, <code>diseaseFocus</code>,
<code>manifestation</code>] columns filled out. Other columns will be
ignored.</p>
<p>An example of this format comes with the package and is shown
below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">example_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"pubs_example.csv"</span>, package <span class="op">=</span> <span class="st">"nfportalutils"</span><span class="op">)</span></span>
<span><span class="va">new_pubs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">example_csv</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">new_pubs</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="18%">
<col width="14%">
<col width="21%">
<col width="40%">
</colgroup>
<thead><tr class="header">
<th align="right">pmid</th>
<th align="left">studyId</th>
<th align="left">diseaseFocus</th>
<th align="left">manifestation</th>
<th align="left">comments</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">38383777</td>
<td align="left">syn11672851</td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left">Drug-Target Explorer</td>
</tr>
<tr class="even">
<td align="right">38383780</td>
<td align="left">syn4939902</td>
<td align="left">Neufibromatosis type 1</td>
<td align="left">MPNST</td>
<td align="left">Johns Hopkins Biobank project</td>
</tr>
<tr class="odd">
<td align="right">38375882</td>
<td align="left">syn51133914|syn51133929</td>
<td align="left">Neufibromatosis type 1</td>
<td align="left">MPNST|Plexiform neurofibroma</td>
<td align="left">DHART project 1and DHART project 2 produced
collaborative paper</td>
</tr>
</tbody>
</table>
<p>Several things to note:</p>
<ul>
<li>Rarely, there may be multiple studies associated with one
publication, so they need to be listed with a “|” (pipe)
separator.<br>
</li>
<li>Indicating nulls is more nuanced for the spreadsheet version due to
differences for STRING vs STRING_LIST – for diseaseFocus, use “NA” while
for manifestation can leave blank.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/add_publications_from_file.html">add_publications_from_file</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="va">example_csv</span>,</span>
<span>  publication_table_id <span class="op">=</span> <span class="va">PUBS_COPY</span>,</span>
<span>  study_table_id <span class="op">=</span> <span class="va">STUDY_TABLE</span>,</span>
<span>  list_sep <span class="op">=</span> <span class="st">"|"</span>,</span>
<span>  dry_run <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Check the new additions in the UI.</p>
<p>To conclude this part of the vignette, clean up the table copy.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">synapser</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/synapser/man/synDelete.html" class="external-link">synDelete</a></span><span class="op">(</span><span class="va">PUBS_COPY</span><span class="op">)</span></span></code></pre></div>
<p>For become even more erudite, review the source code or try some
experiments regarding these concerns:</p>
<ol style="list-style-type: decimal">
<li>What happens with trying to add a pmid that already exists in the
table?</li>
<li>What happens when the pmid is incorrect due to typo?</li>
</ol>
<p>Toggle the code block below to show expected results.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#1. A publication that already exists should be skipped with a message saying so. </span></span>
<span><span class="co">#2. It fails.</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="portal---files-corrections">Portal - Files corrections<a class="anchor" aria-label="anchor" href="#portal---files-corrections"></a>
</h3>
<p>TO DO.</p>
</div>
<div class="section level3">
<h3 id="portal---people-updates">Portal - People updates<a class="anchor" aria-label="anchor" href="#portal---people-updates"></a>
</h3>
<p>Create the table copy.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PEOPLE_COPY</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_table.html">copy_table</a></span><span class="op">(</span><span class="st">"syn16857542"</span>, destination_id <span class="op">=</span> <span class="va">project_id</span><span class="op">)</span></span></code></pre></div>
<p>This relatively simple util finds new people that have made
contributions and adds them to the people table.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/add_people_from_table.html">add_people_from_table</a></span><span class="op">(</span>people_table_id <span class="op">=</span> <span class="va">PEOPLE_COPY</span>, </span>
<span>                      people_column <span class="op">=</span> <span class="st">"ownerId"</span>, </span>
<span>                      source_table_id <span class="op">=</span> <span class="st">"syn16858331"</span>, <span class="co"># READ ONLY from the source table, which is Portal - Files</span></span>
<span>                      source_column <span class="op">=</span> <span class="st">"createdBy"</span>,</span>
<span>                      dry_run <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="portal---studies-updates">Portal - Studies updates<a class="anchor" aria-label="anchor" href="#portal---studies-updates"></a>
</h3>
<div class="section level4">
<h4 id="register-new-study">Register new study<a class="anchor" aria-label="anchor" href="#register-new-study"></a>
</h4>
<p>TO DO.</p>
</div>
<div class="section level4">
<h4 id="augment-with-related-studies">Augment with ‘related studies’<a class="anchor" aria-label="anchor" href="#augment-with-related-studies"></a>
</h4>
<p>TO DO.</p>
<p>Here are some other things to get deeper via the source code and/or
docs:</p>
<ol style="list-style-type: decimal">
<li>Why is there both <code>n_k</code> and and <code>n_clust</code>. Why
is this used with <code>n_k</code> instead of <code>n_clust</code>?</li>
</ol>
<p>Toggle the code block below to show asnwers.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># That's just because `n_clust` generates results as clusters with highly variable numbers of member studies, i.e. there could be 20 studies around this one mainstream topic vs 2-3 in this more arcane topic. The table breaks when list length exceeds a certain limit. Historically, clusters have been used and a max of four studies selected as a workaround. But using `n_k` can give better related results with more control.  </span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert Allaway, Anh Nguyet Vu.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
